# GMINE V3.4 Contract Update

## Important Update (2025-09-02)

The GMINE mining contract has been updated to V3.4 to fix a critical bug that prevented miners from claiming rewards.

### New Contract Addresses

- **Mining Contract**: `inj1h2rq8q2ly6mwgwv4jcd5qpjvfqwvwee5v9n032` (V3.4)
- **Power Token**: `inj18ju0hzpu5ylz0nh7dcwcrssnh8aq4vdhmnr2vg` (NEW V3.4 power token)

### What Changed?

V3.3 had a bug where epochs couldn't be finalized if `advance_epoch` wasn't called, preventing miners from claiming rewards. V3.4 includes a "Just-in-Time History" fix that reconstructs missing epochs on demand.

### Update Instructions

The miner code has been updated to use the new V3.4 contract. If you're running an older version:

1. Pull the latest code:
   ```bash
   git pull origin main
   ```

2. Rebuild the miner:
   ```bash
   cargo build --release --bin simple_miner
   ```

3. Run with the updated contract:
   ```bash
   ./mine-rust.sh -m "your mnemonic here"
   ```

### For Developers

All hardcoded contract addresses have been updated to V3.4:
- `src/chain/messages/mod.rs`
- `gmine_mobile_lib/src/chain/contracts.rs`
- `gmine_mobile_lib/src/mining.rs`
- `gmine_mobile_lib/src/blockchain.rs`
- `gmine_mobile_lib/src/blockchain_direct.rs`
- `gmine_mobile_lib/src/blockchain_hybrid.rs`
- `gmine_mobile_lib/src/eip712.rs`
- `gmine_mobile_lib/src/archive_eip712/*.rs`

### Testing the Fix

You can verify the fix is working by checking if epochs can be finalized:

```bash
# Check current epoch
injectived query wasm contract-state smart inj1h2rq8q2ly6mwgwv4jcd5qpjvfqwvwee5v9n032 '{"current_epoch":{}}' --node https://k8s.testnet.tm.injective.network:443 | jq

# Finalize an epoch (anyone can call this)
echo "backdoor@" | injectived tx wasm execute inj1h2rq8q2ly6mwgwv4jcd5qpjvfqwvwee5v9n032 '{"finalize_epoch":{"epoch_number":NUMBER}}' --from YOUR_WALLET --gas 400000 --gas-prices 160000000inj --node https://k8s.testnet.tm.injective.network:443 --chain-id injective-888 --yes
```

### Previous Contract Versions

- V3.3: `inj1y32mvdpmtz9gpyvxdlldulc6ertxs7z7zajs2j` (deprecated - has bug)
- V2: `inj1mdq8lej6n35lp977w9nvc7mglwc3tqh5cms42y` (old version)