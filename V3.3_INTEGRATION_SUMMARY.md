# V3.3 Integration Summary

## Changes Made

### 1. New Files Created (Only 2!)
- `src/chain/messages/stake.rs` - Handles CW20 Send for staking POWER tokens
- `src/chain/messages/unstake.rs` - Handles UnstakeTokens message

### 2. Files Modified

#### src/chain/messages/mod.rs
- Added imports for stake and unstake modules
- Added `UnstakeTokens` variant to ExecuteMsg enum

#### src/chain/queries.rs
- Added V3.3 query messages and response types
- Added `query_stake_info()` - Get miner's stake details
- Added `query_emission_metrics()` - Get current emission rates
- Added `query_staking_multipliers()` - Get available tiers
- Added `query_power_balance()` - Check POWER token balance

#### src/config/mod.rs
- Added optional staking configuration fields:
  - `stake_duration_days: Option<u64>` (30, 90, 180, 365, 730)
  - `auto_stake_enabled: bool`
  - `min_stake_amount: Option<String>`

#### src/orchestrator/mod.rs
- Added imports for V3.3 query functions
- Added stake status display on startup
- Shows current multiplier and lock duration
- Displays emission metrics

#### src/chain/mod.rs
- Added exports for StakeTokensMsg and UnstakeTokensMsg

#### Cargo.toml
- Added `cosmwasm-std = "1.5"`
- Added `cw20 = "1.1"`

## How It Works

1. **On Startup**: The miner queries and displays your stake status
   - Shows current POWER staked and multiplier (1x-5x)
   - Shows lock duration remaining
   - Shows current emission rates

2. **During Mining**: Nothing changes! The contract automatically applies your multiplier
   - Commit → Reveal → Claim (same flow)
   - Rewards are multiplied based on your stake

3. **Staking** (manual for now, auto-stake coming):
   - Use StakeTokensMsg to send POWER to mining contract
   - Choose lock duration for desired multiplier
   - One-time setup, then forget about it

## Next Steps

To enable auto-staking after claims:
1. Add POWER balance check after successful claim
2. If balance > min_stake_amount and auto_stake_enabled
3. Queue stake transaction with configured duration

## Testing

The miner is fully backward compatible:
- Works without any stake (1x multiplier)
- Works with existing V3.3 contracts
- All V3.3 features are optional